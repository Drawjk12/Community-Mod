on_startup = {
	# water crisis rights
	if = {
		limit ={
			or = {
				culture_group = North_African_culture_Group
			}
		}
		set_variable = {
			which = WaterCrisisLevel
			value = 0
		}
		set_country_flag = has_water_crisis
		add_country_modifier = {
			name = normal_rainfall
			duration = -1
		}
	}
	2440 = {
		add_province_triggered_modifier = rainfall_yearly_trigger
		add_province_modifier = {
			name = rainfall_trigger_modifier
			duration = 364
		}
	}

}

on_monthly_pulse = {
	# Variable modifications
	if = {
		limit = {
			culture_group = North_African_culture_Group
		}
		if = {
			limit = {
				has_country_modifier = heavy_drought_modif
			}
			change_variable = {
				which = WaterCrisisLevel
				value = 0.3
			}
		}
		if = {
			limit = {
				has_country_modifier = minor_drought_modif
			}
			change_variable = {
				which = WaterCrisisLevel
				value = 0.2
			}
		}
		if = {
			limit = {
				has_country_modifier = acidous_rain
			}
			change_variable = {
				which = WaterCrisisLevel
				value = 0.1
			}
		}
		if = {
			limit = {
				has_country_modifier = normal_rainfall
			}
		}
		if = {
			limit = {
				has_country_modifier = good_rainfall
			}
			subtract_variable = {
				which = WaterCrisisLevel
				value = 0.2
			}
		}
		if = {
			limit = {
				has_country_modifier = heavy_rainfall
			}
			subtract_variable = {
				which = WaterCrisisLevel
				value = 0.3
			}
		}
		# cannot over 100
		if = {
			limit = {
				check_variable = {
					which = WaterCrisisLevel
					value = 100
				}
			}
			set_variable = {
				which = WaterCrisisLevel
				value = 100
			}
		}
		# cannot under 0
		if = {
			limit = {
				NOT = {
					check_variable = {
						which = WaterCrisisLevel
						value = 0
					}
				}
			}
			set_variable = {
				which = WaterCrisisLevel
				value = 0
			}
		}
	}

	# event trigger
	every_country = {
		limit = {
			and = {
				or = {
					culture_group = North_African_culture_Group
				}
				check_variable = {
					which = WaterCrisisLevel
					value = 25
				}
				NOT = {
					OR = {
						has_country_flag = had_recent_crisis_25
						has_country_flag = had_recent_crisis_50
						has_country_flag = had_recent_crisis_75
					}
				}
			}
		}
		country_event = {
			id = water_crisis.1
			days = 0
		}
	}

	# Modifiers alteration
	every_country = {
		# if you had the minor crisis and are above 50
		if = {
			limit = {
				AND = {
					has_country_flag = had_recent_crisis_25
					check_variable = {
						which = WaterCrisisLevel
						value = 50
					}
				}
			}
			clr_country_flag = had_recent_crisis_25
		}
		# if you had the major crisis and ar above 75
		if = {
			limit = {
				AND = {
					has_country_flag = had_recent_crisis_50
					check_variable = {
						which = WaterCrisisLevel
						value = 75
					}
				}
			}
			clr_country_flag = had_recent_crisis_50
		}
		# if youre below 25, clear all
		if = {
			limit = {
				NOT = {
					check_variable = {
						which = WaterCrisisLevel
						value = 25
					}
				}
			}
			clr_country_flag = had_recent_crisis_25
			clr_country_flag = had_recent_crisis_50
			clr_country_flag = had_recent_crisis_75

			remove_country_modifier = minor_water_crisis_modif
			remove_country_modifier = major_water_crisis_modif
			remove_country_modifier = extreme_water_crisis_modif
		}
	}

	5061 = {
		if = {
			limit = {
				OWNER = {
					has_country_flag = has_water_crisis
				}
			}
			if = {
				limit = {
					has_great_project = {
						type = any
						tier = 1
					}
				}
				OWNER = {
					subtract_variable = {
						which = WaterCrisisLevel
						value = 0.1
					}
				}
			}
			if = {
				limit = {
					has_great_project = {
						type = any
						tier = 2
					}
				}
				OWNER = {
					subtract_variable = {
						which = WaterCrisisLevel
						value = 0.2
					}
				}
			}
			if = {
				limit = {
					has_great_project = {
						type = any
						tier = 3
					}
				}
				OWNER = {
					subtract_variable = {
						which = WaterCrisisLevel
						value = 0.3
					}
				}
			}
		}
	}
}
